# Fall 24 University at Buffalo Metaverse Research

## Members

- **Yiwei Feng** (University at Buffalo CSE undergraduate student)
- **WanXian Chen** (University at Buffalo CSE undergraduate student)
- **Sreyasee Das Bhattacharjee** (Assistant Professor of Teaching)

## Repository Structure

- **MetaVerseProject**:  
  The project we edited to implement AI avatars interacting in a metaverse environment.

- **PaperResource**:  
  Contains the papers referenced for the research project.

- **PresentationFiles**:  
  Slides and visuals for the final presentation.

---

## Integration Plan: AI-Iris-Avatar and SENEM Metaverse Projects

To integrate both the **AI-Iris-Avatar** and the **SENEM Metaverse** projects in Unity, follow this structured plan to ensure both projects are prepared and work together seamlessly.

### **Step 1: Prepare the AI-Iris-Avatar Unity Project**

1. **Open the AI-Iris-Avatar project** in Unity.
2. **Select Dependencies:**
   - In the **Assets** window, right-click the necessary files (such as models, scripts, and prefabs) and choose **Select Dependencies** to ensure all required components are selected for export.
3. **Export as Unity Package:**

   - Go to **File → Export Package** and ensure all necessary assets are checked.
   - Save the package as `AI_Iris_Avatar.unitypackage`.

4. **Test the Package:**
   - Open a new Unity project and import the package to ensure there are no missing dependencies.

---

### **Step 2: Prepare the SENEM Metaverse Unity Project**

1. **Open the SENEM Metaverse project** in Unity.
2. **Organize Project Hierarchy:**
   - Create a folder in the **Assets** window (e.g., `AI_Avatar`) where the AI avatar and related assets will reside.
3. **Set Up Unity Version Compatibility:**
   - Confirm that both projects use **the same Unity version** to avoid compatibility issues (e.g., 2022.3.21f1 as recommended in the AI-Iris-Avatar documentation).
4. **Install Required Plugins and Libraries:**
   - Import the **Oculus Lipsync** library from the Unity Asset Store or GitHub to support avatar lip-sync functionality.
   - Add the **NativeWebSocket package** if you plan to use WebSocket for communication between the avatar and backend servers.

---

### **Step 3: Import the AI-Iris-Avatar into the SENEM Metaverse Project**

1. **Import the Package:**
   - In the SENEM Metaverse project, go to **Assets → Import Package → Custom Package**.
   - Select the `AI_Iris_Avatar.unitypackage` you created earlier and import it.
2. **Verify Prefabs and Assets:**
   - Check that all models, scripts, and prefabs have been imported correctly without any missing files.

---

### **Step 4: Backend and Communication Setup**

1. **Launch the AI Server:**
   - Navigate to the **AI-Iris-Avatar** backend folder and run the Python server with:
     ```bash
     python server.py --port 8080
     ```
2. **WebSocket Configuration:**

   - In the Unity project, set up WebSocket connections to allow communication between the **SENEM Metaverse** and the **AI backend**. You can use the **NativeWebSocket** library to handle these connections:

     - Add a C# script to open and maintain a WebSocket connection.

     ```csharp
     using NativeWebSocket;

     public class WebSocketConnection : MonoBehaviour {
         WebSocket websocket;

         async void Start() {
             websocket = new WebSocket("ws://localhost:8080");
             websocket.OnMessage += (bytes) => {
                 Debug.Log("Received: " + System.Text.Encoding.UTF8.GetString(bytes));
             };
             await websocket.Connect();
         }
     }
     ```

3. **Sync Lip Sync with Audio:**
   - Configure the **Oculus Lipsync library** to synchronize avatar lip movements with audio generated by the text-to-speech (TTS) module of the AI server.

---

### **Step 5: Test and Debug**

1. **Test WebSocket Communication:**
   - Send a text prompt from the SENEM Metaverse project to the AI backend. Verify if the avatar responds with the correct lip-sync and audio.
2. **Debug Missing Components or Scripts:**
   - If errors occur (e.g., missing assets or components), revisit the **AI-Iris-Avatar project** and ensure all dependencies were included during the export.

---

### **Step 6: Optimize and Customize**

1. **Performance Optimizations:**
   - Adjust the graphics settings or switch to **URP** (Universal Render Pipeline) if targeting mobile platforms.
2. **Custom Animations:**
   - Use Unity's **Mecanim system** to create idle and speaking animations for the avatar, and sync with Mixamo animations if required.

---

### **Issues between Oct 22 and Oct 29**

1. **Version Mismatch and Missing Files:**

   - The **AI-Iris-Avatar** and **SENEM Metaverse** projects are on different Unity versions, which causes issues during import. Some files from the AI-Iris-Avatar project may not import properly into the SENEM Metaverse project.
   - The **SENEM Metaverse** project uses an older Unity version. When opened with the latest Unity editor, it generates compilation errors.

2. **Integrating the Iris Avatar as an NPC AI:**

   - Adding the Iris avatar to the **SENEM Metaverse** requires several operations to be implemented to ensure it functions as a robust NPC with AI capabilities. This involves setting up appropriate animations, behaviors, and interactions within the metaverse.

3. **WebSocket Connection Code Placement:**
   - A key challenge is determining the appropriate place to add the C# code that opens and maintains the WebSocket connection. Proper placement is crucial to ensure seamless communication between the AI backend and the metaverse environment.

---

## Conclusion

This plan ensures a smooth integration of the AI-Iris-Avatar and SENEM Metaverse projects, allowing for robust interaction between the avatar and the metaverse environment. Thorough testing and optimization will enhance the performance and interactivity of the final application.
